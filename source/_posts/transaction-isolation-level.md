---
title: 事务隔离级别
excerpt: 介绍事务及其ACID特性，说明隔离级别的作用，列出四个级别及其问题，不同业务场景的推荐级别和优化效果。
date: 2025-07-08 09:14:00
tags:
  - 数据库
  - 事务
categories:
  - 数据库
---
### 一、什么是事务

事务是数据库操作的最小单元，事务中的所有操作都成功，则事务成功，否则事务失败。

### 二、事务的 ACID

事务具有四个特征：原子性、一致性、隔离性和持续性。这四个特性简称为 ACID 特性。

* `原子性（Atomicity）`：事务是数据库的逻辑工作单位，事务中包含的各操作要么都做，要么都不做。

* ` 一致性（Consistency）`：事务执行的结果必须是使数据库从一个一致性状态变到另一个一致性状态。因此当数据库只包含成功事务提交的结果时，就说数据库处于一致性状态。如果数据库系统 运行中发生故障，有些事务尚未完成就被迫中断，这些未完成事务对数据库所做的修改有一部分已写入物理数据库，这时数据库就处于一种不正确的状态，或者说是 不一致的状态。

* `隔离性（Isolation）`：一个事务的执行不能其它事务干扰。即一个事务内部的操作及使用的数据对其它并发事务是隔离的，并发执行的各个事务之间不能互相干扰。

* `持续性（Durability）`：也称永久性，指一个事务一旦提交，它对数据库中的数据的改变就应该是永久性的。接下来的其它操作或故障不应该对其执行结果有任何影响。

### 三、事务隔离级别

* `读未提交（Read Uncommitted）`：在该隔离级别，所有事务都可以看到其他未提交事务的执行结果。读取未提交的数据，也被称之为脏读。无共享锁，锁等待概率最低但数据风险最高。

* `读已提交（Read Committed）（默认）`：大多数数据库系统的默认隔离级别（不包括MySQL）。它满足了隔离的简单定义：一个事务只能看见已经提交事务所做的改变。这种隔离级别也支持不可重复读，因为同一事务的其他实例在该实例处理其间可能会有新的commit，所以同一select可能返回不同结果。写操作加行级排他锁，读操作无锁。

* `可重复读（Repeatable Read）`：这是MySQL的默认事务隔离级别，它确保同一事务的多个实例在并发读取数据时，会看到同样的数据行。不过理论上，这会导致另一个棘手的问题：幻读。简单的说，幻读指当用户读取某一范围的数据行时，另一个事务又在该范围内插入了新行，当用户再读取该范围的数据行时，会发现有新的“幻影”行。InnoDB和Falcon存储引擎通过多版本并发控制（MVCC，Multiversion Concurrency Control）机制解决了该问题。读操作加共享锁直至事务结束，易引发范围锁等待。

* `串行化（Srializable）`：最高隔离级别，通过强制事务排序，使之不可能相互冲突，从而解决幻读问题。它是在每个读的数据行上加上共享锁，锁竞争最激烈。
  
  > * 脏读（Drity Read）：某个事务已更新一份数据，另一个事务在此时读取了同一份数据，由于某些原因，前一个RollBack了操作，则后一个事务所读取的数据就会是不正确的。
  > 
  > * 不可重复读（Non-repeatable read）：在一个事务的两次查询之中数据不一致，这可能是两次查询过程中间插入了一个事务更新的原有的数据。
  > 
  > * 幻读（Phantom Read）：在一个事务的两次查询中数据列数不一致，例如有一个事务查询了几列(Row)数据，而另一个事务却在此时插入了新的几列数据，先前的事务在接下来的查询中，就有几列数据是未查询出来的，如果此时插入和另外一个事务插入的数据，就会报错。

### 四、隔离级别优化实践

  | 业务类型 | 推荐隔离级别 | 优化效果  |
  | --- | --- | --- |
  | 实时报表 | 读已提交 | 避免长事务持有共享锁 |
  | 资金交易 | 可重复读 | 保证余额一致性，需配合锁超时机制 |
  | 历史数据迁移 | 读未提交 | 允许脏读，提升批量导入速度 |

  > * 在电商库存扣减中，采用读已提交+乐观锁version字段，减少80%锁等待
  > * 银行转账场景保留可重复读，但需设置innodb_lock_wait_timeout=3（秒）


